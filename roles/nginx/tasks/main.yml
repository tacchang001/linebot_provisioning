- name: template service config
  copy:
    src: "files/{{ app_name }}.conf"
    dest: "/etc/init/{{ app_name }}.conf"

- name: start app service
  service: name={{ app_name }} state=restarted enabled=yes

- name: template nginx site config
  template:
    src: "files/{{ app_name }}.nginx"
    dest: /etc/nginx/sites-available/{{ app_name }}

- name: remove default nginx site config
  file: path=/etc/nginx/sites-enabled/default state=absent

- name: enable nginx site
  file:
    src: /etc/nginx/sites-available/{{ app_name }}
    dest: /etc/nginx/sites-enabled/default
    state: link
    force: yes

- name: restart nginx
  service: name=nginx state=restarted enabled=yes

- name: open firewall for nginx
  ufw:
    rule: allow
    name: Nginx Full
